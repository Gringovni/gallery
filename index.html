<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Latent Illumination • Index</title>
  <link rel="icon" type="image/png" href="fast-forward.png">
  <link rel="apple-touch-icon" href="fast-forward.png">

  <meta name="description" content="A controlled visual practice focused on clarity, intent, and art-directed synthetic imaging.">
  <meta name="theme-color" content="#ffffff" />

  <!-- Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Latent Illumination" />
  <meta property="og:description" content="A controlled visual practice focused on clarity, intent, and art-directed synthetic imaging.">
  <meta property="og:image" content="https://www.latentillumination.com/social-preview.jpg">
  <meta property="twitter:image" content="https://www.latentillumination.com/social-preview.jpg">

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:ital,wght@0,300;0,400;1,300&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,wght@0,300;1,300&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="style.css">
</head>

<body>
  <a href="#masonry" class="skip-link">Skip to gallery</a>

  <!-- HERO -->
<section class="hero" id="hero" aria-label="Hero" data-scroll-target="#masonry">
  <div class="hero-media" id="heroMedia" style="background-image:url('https://images.pexels.com/photos/20398189/pexels-photo-20398189.jpeg?auto=compress&cs=tinysrgb&w=2400');"></div>

    <!-- Hero editorial text -->
<div class="hero-caption">
  <span class="hero-caption-line">Where creative</span>
  <span class="hero-caption-line">intent becomes</span>
  <span class="hero-caption-line">visual clarity</span>
</div>

  <!-- Scroll cue arrow -->
  <button class="hero-scroll" type="button" aria-label="Scroll to gallery" id="heroScrollBtn"></button>
</section>

  <header class="hero-banner" role="banner" aria-label="Site header">
    <div class="hero-banner-inner">
      <div class="hero-banner-title">LATENT ILLUMINATION</div>
    </div>
    <div class="hero-banner-divider"></div>
  </header>

  <main class="wrap">
    <section id="masonry" class="masonry" aria-label="Gallery" aria-busy="false" aria-live="polite">
      <p class="masonry-loading" id="masonryLoading">Loading gallery…</p>
      <p class="masonry-error hidden" id="masonryError" role="alert"></p>
    </section>

    <section class="editorial-layout" aria-label="Project framework">
      
      <article class="editorial-block">
        <h2 class="editorial-label">Intent</h2>
        <div class="editorial-prose">
          <p>An approach to making AI-generated imagery predictable, intentional, and ready for professional visual contexts.</p>
        </div>
      </article>
      
      <article class="editorial-block">
        <h2 class="editorial-label">Context</h2>
        <div class="editorial-prose">
          <p>AI image generation is powerful, but often unpredictable. As models improve, the limiting factor is no longer capability, but control. Visual outcomes are shaped by how intent is structured in language, and small inconsistencies in description can quickly compound into noise.</p>
          <p>The work shown here treats prompts as designed constructs rather than improvised instructions. Intent is separated from execution, allowing framing, lighting behavior, mood, and physical logic to be considered deliberately before being expressed as natural language. This prioritizes coherence and hierarchy over rapid experimentation or stylistic accumulation.</p>
          <p>Rather than chasing variation, the focus is on reliability: establishing a clear internal logic that can be maintained across iteration, adjustment, and reuse.</p>
        </div>
      </article>

      <article class="editorial-block execution-layer">
        <h2 class="editorial-label">Execution Layer</h2>
        <div class="editorial-prose">
          <p>This is not a tool or automated system, but a controlled practice. AI functions as the execution layer, while authorship and judgment remain human. The objective is to reduce ambiguity, stabilize results, and maintain visual clarity from concept to final delivery.</p>
        </div>
      </article>

    </section>
  </main>

  <footer class="site-footer" role="contentinfo">
    <!-- Footer divider line (restored; must be first visually) -->
    <div class="footer-divider"></div>

    <!-- Footer scroll-to-top arrow (NEW) -->
    <button class="footer-scroll" id="footerScroll" type="button" aria-label="Scroll to gallery"></button>

    <div class="footer-line footer-main">© 2026 Latent Illumination | <a class="footer-email" href="mailto:contact@latentillumination.com" title="Email Latent Illumination">contact@latentillumination.com</a></div>
    <div class="footer-line footer-powered">Powered by <a class="footer-github" href="https://github.com/" target="_blank" rel="noopener noreferrer">GitHub</a></div>
  </footer>

  <!-- Lightbox: close button outside .lb so touches always register on mobile -->
  <div class="lb-container" id="lbContainer" aria-hidden="true">
    <div class="lb" id="lb" role="dialog" aria-label="Image viewer">
      <button class="lb-nav lb-prev" id="lbPrev" aria-label="Previous">‹</button>
      <div class="lb-viewport">
      <div class="lb-track">
      <div class="lb-slide-slot">
        <div class="lb-content" role="document">
          <div class="lb-media">
            <a class="lb-media-link" target="_blank" rel="noopener noreferrer" href="#" aria-label="Open image in new tab">
              <img class="lb-img" alt="" />
            </a>
          </div>
          <aside class="lb-side" aria-label="Prompt">
            <div class="lb-prompt-wrap">
              <pre class="lb-prompt"><span class="lb-prompt-label">PROMPT:</span><span class="lb-prompt-text"></span></pre>
            </div>
            <div class="lb-actions">
              <button type="button" class="lb-prompt-more" aria-label="Show more prompt" aria-expanded="false"><svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" fill="currentColor" aria-hidden="true"><path d="M240-400q-33 0-56.5-23.5T160-480q0-33 23.5-56.5T240-560q33 0 56.5 23.5T320-480q0 33-23.5 56.5T240-400Zm240 0q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm240 0q-33 0-56.5-23.5T640-480q0-33 23.5-56.5T720-560q33 0 56.5 23.5T800-480q0 33-23.5 56.5T720-400Z"/></svg></button>
              <button type="button" class="lb-copy" aria-label="Copy prompt to clipboard"><span class="material-symbols-outlined lb-copy-icon" aria-hidden="true">content_copy</span></button>
              <button type="button" class="lb-open-new" aria-label="Open image in new tab"><svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" fill="currentColor" aria-hidden="true"><path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h280v80H200v560h560v-280h80v280q0 33-23.5 56.5T760-120H200Zm188-212-56-56 372-372H560v-80h280v280h-80v-144L388-332Z"/></svg></button>
            </div>
          </aside>
        </div>
      </div>
      <div class="lb-slide-slot">
        <div class="lb-content" role="document">
          <div class="lb-media">
            <a class="lb-media-link" target="_blank" rel="noopener noreferrer" href="#" aria-label="Open image in new tab">
              <img class="lb-img" alt="" />
            </a>
          </div>
          <aside class="lb-side" aria-label="Prompt">
            <div class="lb-prompt-wrap">
              <pre class="lb-prompt"><span class="lb-prompt-label">PROMPT:</span><span class="lb-prompt-text"></span></pre>
            </div>
            <div class="lb-actions">
              <button type="button" class="lb-prompt-more" aria-label="Show more prompt" aria-expanded="false"><svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" fill="currentColor" aria-hidden="true"><path d="M240-400q-33 0-56.5-23.5T160-480q0-33 23.5-56.5T240-560q33 0 56.5 23.5T320-480q0 33-23.5 56.5T240-400Zm240 0q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm240 0q-33 0-56.5-23.5T640-480q0-33 23.5-56.5T720-560q33 0 56.5 23.5T800-480q0 33-23.5 56.5T720-400Z"/></svg></button>
              <button type="button" class="lb-copy" aria-label="Copy prompt to clipboard"><span class="material-symbols-outlined lb-copy-icon" aria-hidden="true">content_copy</span></button>
              <button type="button" class="lb-open-new" aria-label="Open image in new tab"><svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" fill="currentColor" aria-hidden="true"><path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h280v80H200v560h560v-280h80v280q0 33-23.5 56.5T760-120H200Zm188-212-56-56 372-372H560v-80h280v280h-80v-144L388-332Z"/></svg></button>
            </div>
          </aside>
        </div>
      </div>
      <div class="lb-slide-slot">
        <div class="lb-content" role="document">
          <div class="lb-media">
            <a class="lb-media-link" target="_blank" rel="noopener noreferrer" href="#" aria-label="Open image in new tab">
              <img class="lb-img" alt="" />
            </a>
          </div>
          <aside class="lb-side" aria-label="Prompt">
            <div class="lb-prompt-wrap">
              <pre class="lb-prompt"><span class="lb-prompt-label">PROMPT:</span><span class="lb-prompt-text"></span></pre>
            </div>
            <div class="lb-actions">
              <button type="button" class="lb-prompt-more" aria-label="Show more prompt" aria-expanded="false"><svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" fill="currentColor" aria-hidden="true"><path d="M240-400q-33 0-56.5-23.5T160-480q0-33 23.5-56.5T240-560q33 0 56.5 23.5T320-480q0 33-23.5 56.5T240-400Zm240 0q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm240 0q-33 0-56.5-23.5T640-480q0-33 23.5-56.5T720-560q33 0 56.5 23.5T800-480q0 33-23.5 56.5T720-400Z"/></svg></button>
              <button type="button" class="lb-copy" aria-label="Copy prompt to clipboard"><span class="material-symbols-outlined lb-copy-icon" aria-hidden="true">content_copy</span></button>
              <button type="button" class="lb-open-new" aria-label="Open image in new tab"><svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" fill="currentColor" aria-hidden="true"><path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h280v80H200v560h560v-280h80v280q0 33-23.5 56.5T760-120H200Zm188-212-56-56 372-372H560v-80h280v280h-80v-144L388-332Z"/></svg></button>
            </div>
          </aside>
        </div>
      </div>
    </div>
      </div>
      <button class="lb-nav lb-next" id="lbNext" aria-label="Next">›</button>
    </div>
    <button class="lb-close" id="lbClose" aria-label="Close">×</button>
  </div>

  <script>
    const masonry = document.getElementById("masonry");

    const lbContainer = document.getElementById("lbContainer");
    const lb = document.getElementById("lb");
    const lbClose = document.getElementById("lbClose");
    const lbPrev = document.getElementById("lbPrev");
    const lbNext = document.getElementById("lbNext");
    const masonryLoading = document.getElementById("masonryLoading");
    const masonryError = document.getElementById("masonryError");

    let items = [];
    let currentIndex = -1;
    let lastFocusBeforeLB = null;

    function formatPrompt(raw){
      const text = (raw || "").toString();

      // Remove any MODEL line(s)
      const noModel = text
        .split(/\r?\n/)
        .filter(line => !/^\s*MODEL\s*:/i.test(line.trim()))
        .join("\n")
        .trim();

      // If the remaining text already starts with PROMPT:, keep it.
      if (/^\s*PROMPT\s*:/i.test(noModel)) return noModel.trim();

      // Otherwise, wrap it as PROMPT:
      if (!noModel) return "";
      return `PROMPT:\n${noModel}`;
    }

    function parsePrompt(formatted) {
      if (!formatted || !formatted.trim()) return { label: "", text: "" };
      const cleaned = formatted.trim().replace(/^\s*PROMPT\s*:\s*\n?/i, "");
      return { label: "PROMPT:", text: cleaned };
    }

    function populateSlot(slot, index) {
      const img = slot.querySelector(".lb-img");
      const link = slot.querySelector(".lb-media-link");
      const labelEl = slot.querySelector(".lb-prompt-label");
      const textEl = slot.querySelector(".lb-prompt-text");
      const wrap = slot.querySelector(".lb-prompt-wrap");
      const moreBtn = slot.querySelector(".lb-prompt-more");

      // === NEW: Reset Scroll State on Slide Change ===
      const side = slot.querySelector(".lb-side");
      if (side) {
        side.scrollTop = 0; // Jump to top
        side.classList.remove("scrolled"); // Hide top fade
      }
      // ===============================================

      if (index < 0 || index >= items.length) {
        slot.classList.add("lb-slot-hidden");
        if (img) { img.src = ""; img.alt = ""; }
        if (link) link.removeAttribute("href");
        if (labelEl) labelEl.textContent = "";
        if (textEl) textEl.textContent = "";
        if (wrap) wrap.classList.remove("lb-prompt-expanded");
        if (moreBtn) moreBtn.setAttribute("aria-expanded", "false");
        return;
      }
      slot.classList.remove("lb-slot-hidden");
      const item = items[index];
      if (img) { img.src = item.src; img.alt = item.title || ""; }
      if (link) link.href = item.src;
      const { label, text } = parsePrompt(formatPrompt(item.prompt ?? item.caption ?? ""));
      if (labelEl) labelEl.textContent = label;
      if (textEl) textEl.textContent = text;
      if (wrap) wrap.classList.remove("lb-prompt-expanded");
      if (moreBtn) moreBtn.setAttribute("aria-expanded", "false");
    }

    function renderCarousel(centerIndex) {
      const track = lb.querySelector(".lb-track");
      const slots = lb.querySelectorAll(".lb-slide-slot");
      if (!track || slots.length !== 3) return;
      
      const len = items.length;
      if (len === 0) return;

      // Infinite Loop Logic: Wrap indices
      const idxPrev = (centerIndex - 1 + len) % len;
      const idxCur = centerIndex;
      const idxNext = (centerIndex + 1) % len;

      populateSlot(slots[0], idxPrev);
      populateSlot(slots[1], idxCur);
      populateSlot(slots[2], idxNext);
      
      track.classList.remove("lb-animating");
      track.style.transform = "translate3d(-33.3333%, 0, 0)";
    }

    function openLB(index) {
      currentIndex = index;
      lastFocusBeforeLB = document.activeElement;
      renderCarousel(currentIndex);
      lbContainer.classList.add("open");
      lbContainer.setAttribute("aria-hidden", "false");
      
      // FIX: Lock the background page scroll
      document.body.style.overflow = "hidden";
      
      updateNavState();
      lbClose.focus();
    }

    function closeLB() {
      lbContainer.classList.remove("open");
      lbContainer.setAttribute("aria-hidden", "true");
      
      // FIX: Restore background page scroll
      document.body.style.overflow = "";
      
      currentIndex = -1;
      if (lastFocusBeforeLB && lastFocusBeforeLB.focus) lastFocusBeforeLB.focus();
    }

    function updateNavState(){
      // Always enable buttons if we have more than 1 item
      const hasMultiple = items.length > 1;
      lbPrev.disabled = !hasMultiple;
      lbNext.disabled = !hasMultiple;
      lbPrev.style.opacity = hasMultiple ? "1" : "0.25";
      lbNext.style.opacity = hasMultiple ? "1" : "0.25";
    }

    function updateLbOverflow(side) {
      if (!side) return;
      const isMobileLandscape = window.matchMedia("(orientation: landscape) and (max-height: 600px)").matches;
      if (!isMobileLandscape) {
        side.classList.remove("lb-overflow");
        return;
      }
      const isOverflowing = side.scrollHeight > side.clientHeight + 1;
      side.classList.toggle("lb-overflow", isOverflowing);
    }

    function prev() {
      if (items.length < 2) return;
      // Wrap: If at 0, go to last
      currentIndex = (currentIndex - 1 + items.length) % items.length;
      renderCarousel(currentIndex);
    }

    function next() {
      if (items.length < 2) return;
      // Wrap: If at last, go to 0
      currentIndex = (currentIndex + 1) % items.length;
      renderCarousel(currentIndex);
    }

    async function load(){
      masonry.setAttribute("aria-busy", "true");
      masonryLoading.classList.remove("hidden");
      masonryError.classList.add("hidden");
      masonryError.textContent = "";

      try {
        const res = await fetch("gallery.json?v=" + Date.now(), { cache: "no-store" });
        if (!res.ok) throw new Error("Failed to load gallery");
        items = await res.json();
      } catch (err) {
        masonryError.textContent = "Could not load gallery. Please try again later.";
        masonryError.classList.remove("hidden");
        masonryLoading.classList.add("hidden");
        masonry.setAttribute("aria-busy", "false");
        return;
      }

      masonryLoading.classList.add("hidden");
      masonryError.classList.add("hidden");
      masonry.setAttribute("aria-busy", "false");

      const existingCards = masonry.querySelectorAll(".card");
      existingCards.forEach((el) => el.remove());

      items.forEach((item, i) => {
        const card = document.createElement("article");
        card.className = "card";
        card.tabIndex = 0;
        card.setAttribute("role", "button");
        card.setAttribute("aria-label", `View image ${i + 1}: ${item.title || "Untitled"}`);

        const img = document.createElement("img");
        img.loading = "lazy";
        img.src = item.thumb || item.src;
        img.alt = item.title || "";
        img.className = "card-img";

        // Add click event to each card
        card.addEventListener("click", (e) => {
          e.preventDefault();

          // 1. FREEZE: Keep the lift active instantly
          card.classList.add("lb-hold");

          // 2. OPEN LIGHTBOX
          openLB(i);

          // 3. CLEANUP (Behind the scenes)
          // Wait for the lightbox fade-in (approx 350ms)
          setTimeout(() => {
            card.classList.remove("lb-hold"); // Unfreeze the lift
            card.blur(); // CRITICAL: Remove browser focus so the card is "fresh" when you return
          }, 350);
        });
        card.addEventListener("keydown", (e) => { if (e.key === "Enter" || e.key === " ") { e.preventDefault(); openLB(i); } });

        card.appendChild(img);
        masonry.appendChild(card);
      });
    }

    lbClose.addEventListener("click", closeLB);
    lbPrev.addEventListener("click", prev);
    lbNext.addEventListener("click", next);

    // MAIN LIGHTBOX CLICK HANDLER (Handles Nav, Toggles, Actions)
    lb.addEventListener("click", (e) => {
      // 1. Identify which slide slot was clicked
      const slot = e.target.closest(".lb-slide-slot");
      if (!slot) return; // Click was on the background/track, handled by other listeners

      // 2. Identify interactive elements
      const openNewBtn = e.target.closest(".lb-open-new");
      const promptMoreBtn = e.target.closest(".lb-prompt-more"); // The (...) button
      const promptWrap = e.target.closest(".lb-prompt-wrap");    // <--- NEW: The text body
      const copyBtn = e.target.closest(".lb-copy");

      // --- ACTION: Open Original Image ---
      if (openNewBtn) {
        const link = slot.querySelector(".lb-media-link");
        if (link && link.href) window.open(link.href, "_blank", "noopener,noreferrer");
        return;
      }

      // --- ACTION: Expand/Collapse Text (Clicking Button OR Text Body) ---
      if (promptMoreBtn || promptWrap) {

        // 1. Check if the user specifically clicked the BUTTON (or icon inside it)
        const isClickingButton = promptMoreBtn && (e.target === promptMoreBtn || promptMoreBtn.contains(e.target));

        // 2. LOGIC GUARD:
        // If they clicked the TEXT (not the button) AND they have text selected -> STOP.
        // This prevents the box from closing when someone is just trying to copy text.
        if (!isClickingButton && window.getSelection().toString().length > 0) return;

        // 3. Proceed with Toggle
        const wrap = slot.querySelector(".lb-prompt-wrap");
        const btn = slot.querySelector(".lb-prompt-more"); // Get button to sync icon state

        if (wrap) {
          const expanded = wrap.classList.toggle("lb-prompt-expanded");

          // Sync the button's icon/state
          if (btn) {
            btn.setAttribute("aria-expanded", expanded);
            btn.setAttribute("aria-label", expanded ? "Show less prompt" : "Show more prompt");
          }

          // === FIX: Reset Scroll & Fade State on Toggle ===
          // This ensures every expand is a "fresh reading session" (no persisted top fade)
          const side = slot.querySelector(".lb-side");
          if (side) {
            side.scrollTop = 0;
            side.classList.remove("scrolled");
            updateLbOverflow(side);
          }
        }
        return;
      }

      // --- ACTION: Copy Prompt ---
      if (copyBtn) {
        const textEl = slot.querySelector(".lb-prompt-text");
        const text = (textEl && textEl.textContent || "").trim();
        if (!text) return;
        
        navigator.clipboard.writeText(text).then(() => {
          const icon = copyBtn.querySelector(".lb-copy-icon");
          if (icon) {
            const orig = icon.textContent;
            icon.textContent = "done"; // Visual feedback
            setTimeout(() => { icon.textContent = orig; }, 1500);
          }
        });
      }
    });

    lb.addEventListener("click", (e) => {
      if (e.target === lb) closeLB();
    });

    window.addEventListener("resize", () => {
      document.querySelectorAll(".lb-side").forEach(updateLbOverflow);
    });

    /* Mobile: touchend fallback so close works even when click is blocked */
    lbClose.addEventListener("touchend", (e) => {
      e.preventDefault();
      closeLB();
    }, { passive: false });

    lbContainer.addEventListener("keydown", (e) => {
      if (!lbContainer.classList.contains("open")) return;
      if (e.key === "Tab") {
        const focusables = Array.from(lbContainer.querySelectorAll("button:not([disabled])"));
        const first = focusables[0], last = focusables[focusables.length - 1];
        if (e.shiftKey && document.activeElement === first) { e.preventDefault(); last.focus(); }
        else if (!e.shiftKey && document.activeElement === last) { e.preventDefault(); first.focus(); }
      }
    });

    document.addEventListener("keydown", (e) => {
      if (!lbContainer.classList.contains("open")) return;
      
      // Navigation
      if (e.key === "Escape") closeLB();
      if (e.key === "ArrowLeft") prev();
      if (e.key === "ArrowRight") next();

      // Power User: 'C' to Copy Prompt
      if (e.key.toLowerCase() === "c") {
        // Find the button in the CENTER slot (currently visible)
        const slots = lb.querySelectorAll(".lb-slide-slot");
        if (slots[1]) { // Slot 1 is always the active/center slide
          const copyBtn = slots[1].querySelector(".lb-copy");
          if (copyBtn) copyBtn.click(); // Trigger native click + animation
        }
      }

      // Power User: 'O' to Open Original
      if (e.key.toLowerCase() === "o") {
        const slots = lb.querySelectorAll(".lb-slide-slot");
        if (slots[1]) {
          const openBtn = slots[1].querySelector(".lb-open-new");
          if (openBtn) openBtn.click();
        }
      }
    });

    // MOUSE WHEEL NAV (Desktop) — Scroll to change slides
    (function(){
      let wheelCooldown = false;
      
      lb.addEventListener("wheel", (e) => {
        // 1. SAFETY: If mouse is over the text panel, allow normal text scrolling.
        // Don't switch images while user is trying to read.
        if (e.target.closest(".lb-side")) return;

        // 2. Prevent page background from scrolling
        e.preventDefault();

        // 3. Cooldown: Prevent one scroll "flick" from skipping multiple images
        if (wheelCooldown) return;
        
        // Threshold: ignore tiny trackpad jitters
        if (Math.abs(e.deltaY) < 15) return;

        wheelCooldown = true;
        setTimeout(() => { wheelCooldown = false; }, 250); // 250ms delay between slides

        // 4. Navigate
        if (e.deltaY > 0) next();      // Scroll Down -> Next
        else if (e.deltaY < 0) prev(); // Scroll Up -> Prev
      }, { passive: false });
    })();

    // Mobile: Live drag on 3-panel track; swipe-back fixed via better intent detection
    (function(){
      const track = document.querySelector(".lb-track");
      if (!track) return;

      let startX = 0, startY = 0;
      let currentDeltaX = 0;
      let isDragging = false;
      let isScrolling = false;
      let isIntentDetermined = false;
      const thresholdPercent = 0.2;
      const intentThresholdPx = 12;  /* don't decide scroll vs swipe until we've moved this far */
      const scrollRatio = 1.5;       /* require vertical to be 1.5× horizontal to treat as scroll */

      function setTrackTransform(offsetPx) {
        track.style.transform = `translate3d(calc(-33.3333% + ${offsetPx}px), 0, 0)`;
      }

      track.addEventListener("touchstart", (e) => {
        if (e.touches.length > 1) return;
        startX = e.touches[0].clientX;
        startY = e.touches[0].clientY;
        currentDeltaX = 0;
        isDragging = true;
        isScrolling = false;
        isIntentDetermined = false;
        track.classList.remove("lb-animating");
      }, { passive: true });

      track.addEventListener("touchmove", (e) => {
        if (!isDragging) return;
        const x = e.touches[0].clientX;
        const y = e.touches[0].clientY;
        const deltaX = x - startX;
        const deltaY = y - startY;
        const absX = Math.abs(deltaX);
        const absY = Math.abs(deltaY);

        if (!isIntentDetermined) {
          const total = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
          if (total < intentThresholdPx) return; /* wait for meaningful movement */
          if (absY > scrollRatio * absX) {
            isScrolling = true;
            isDragging = false;
            return;
          }
          isIntentDetermined = true;
        }
        if (isScrolling) return;
        currentDeltaX = deltaX;
        setTrackTransform(deltaX);
      }, { passive: true });

      track.addEventListener("touchend", (e) => {
        if (!isDragging || isScrolling) return;
        isDragging = false;
        track.classList.add("lb-animating");
        const thresholdPx = lb.offsetWidth * thresholdPercent;
        // Allow swipe wrapping
        const goPrev = currentDeltaX > thresholdPx && items.length > 1;
        const goNext = currentDeltaX < -thresholdPx && items.length > 1;

        if (goNext) {
          track.style.transform = "translate3d(-66.6666%, 0, 0)";
          track.addEventListener("transitionend", function onEnd() {
            track.removeEventListener("transitionend", onEnd);
            // Wrap Next
            currentIndex = (currentIndex + 1) % items.length;
            renderCarousel(currentIndex);
            updateNavState();
          }, { once: true });
        } else if (goPrev) {
          track.style.transform = "translate3d(0%, 0, 0)";
          track.addEventListener("transitionend", function onEnd() {
            track.removeEventListener("transitionend", onEnd);
            // Wrap Prev
            currentIndex = (currentIndex - 1 + items.length) % items.length;
            renderCarousel(currentIndex);
            updateNavState();
          }, { once: true });
        } else {
          track.style.transform = "translate3d(-33.3333%, 0, 0)";
        }
      });
    })();

    load();

    // HERO PARALLAX — RAF loop for smooth updates on mobile (iOS delays scroll events)
    (function(){
      const hero = document.getElementById("hero");
      const media = document.getElementById("heroMedia");
      if(!hero || !media) return;

      const reduceMotion = window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;
      if(reduceMotion) return;

      function update(){
        const rect = hero.getBoundingClientRect();
        if (rect.bottom <= 0 || rect.top >= window.innerHeight) return;

        const progress = Math.min(Math.max(-rect.top / rect.height, 0), 1);
        const isDesktop = window.innerWidth >= 900;
        const maxTranslate = isDesktop ? 260 : 170;
        const maxScaleOut  = isDesktop ? 0.14 : 0.10;
        const translate = progress * maxTranslate;
        const scale = 1.14 - progress * maxScaleOut;

        media.style.transform = `translate3d(0, ${translate}px, 0) scale(${scale})`;
      }

      function loop(){
        update();
        requestAnimationFrame(loop);
      }
      requestAnimationFrame(loop);
    })();

    // Smooth scroll to gallery (used by hero click and hero scroll button)
    function smoothScrollToGallery(){
      const target = document.getElementById("masonry");
      const banner = document.querySelector(".hero-banner");
      if(!target) return;
      const startY = window.scrollY;
      const offset = banner ? banner.offsetHeight : 0;
      const targetY = target.getBoundingClientRect().top + window.scrollY - offset;
      const distance = targetY - startY;
      const duration = 1400;
      const startTime = performance.now();
      function easeInOutCubic(t){ return t < 0.5 ? 4*t*t*t : 1 - Math.pow(-2*t + 2, 3) / 2; }
      function step(now){
        const elapsed = now - startTime;
        const t = Math.min(elapsed / duration, 1);
        window.scrollTo(0, startY + distance * easeInOutCubic(t));
        if(t < 1) requestAnimationFrame(step);
      }
      requestAnimationFrame(step);
    }

    (function(){
      const hero = document.getElementById("hero");
      const heroScrollBtn = document.getElementById("heroScrollBtn");
      const target = document.getElementById("masonry");
      if(!hero || !target) return;
      hero.style.cursor = "pointer";
      hero.addEventListener("click", (e) => { if (e.target === hero || e.target.closest(".hero-media") || e.target.closest(".hero-caption")) smoothScrollToGallery(); });
      if (heroScrollBtn) heroScrollBtn.addEventListener("click", (e) => { e.stopPropagation(); smoothScrollToGallery(); });
    })();

    // FOOTER ARROW CLICK → SCROLL TO TOP (mirrored behavior)
(function(){
  const btn = document.getElementById("footerScroll");
  const target = document.getElementById("masonry");
  const banner = document.querySelector(".hero-banner");
  if(!btn || !target) return;

  btn.addEventListener("click", () => {
    const startY = window.scrollY;
    const offset = banner ? banner.offsetHeight : 0;
    const targetY =
      target.getBoundingClientRect().top + window.scrollY - offset;
    const distance = targetY - startY;

        const duration = 1400; // ms (matches hero)
        const startTime = performance.now();

        function easeInOutCubic(t){
          return t < 0.5 ? 4*t*t*t : 1 - Math.pow(-2*t + 2, 3) / 2;
        }

        function step(now){
          const elapsed = now - startTime;
          const t = Math.min(elapsed / duration, 1);
          const eased = easeInOutCubic(t);

          window.scrollTo(0, startY + distance * eased);

          if(t < 1) requestAnimationFrame(step);
        }

        requestAnimationFrame(step);
      });
    })();

    // TABLET TOP FADE LOGIC — Tracks scroll position to toggle header fade
    (function(){
      const sides = document.querySelectorAll(".lb-side");
      sides.forEach(side => {
        side.addEventListener("scroll", () => {
          // If scrolled down more than 10px, add class to show top fade
          if (side.scrollTop > 10) side.classList.add("scrolled");
          else side.classList.remove("scrolled");
        }, { passive: true });
      });
    })();
  </script>
</body>
</html>
