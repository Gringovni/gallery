<!-- index.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Latent Illumination</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" type="image/png" href="assets/01-fast-forward.png">
</head>

<body>
  <header class="topbar">
    <div class="topbar-inner">
      <!-- LEFT (empty on purpose) -->
      <div class="tabs" aria-hidden="true"></div>

      <!-- CENTER -->
      <div class="brand">Latent Illumination</div>

      <!-- RIGHT (empty on purpose) -->
      <div class="top-actions" aria-hidden="true"></div>
    </div>

    <!-- thin gray line only -->
    <div class="top-divider"></div>
  </header>

  <!-- HERO -->
  <section class="hero" id="hero" aria-label="Hero">
    <div class="hero-media" id="heroMedia" style="background-image:url('https://picsum.photos/1920/1200');"></div>
  </section>

  <!-- WHITE BANNER (NEW) — lives directly below the hero image -->
  <section class="hero-banner" aria-label="Banner">
    <div class="hero-banner-inner">
      <div class="hero-banner-title">LATENT ILLUMINATION</div>
    </div>
    <div class="hero-banner-divider"></div>
  </section>

  <main class="wrap">
    <section id="masonry" class="masonry" aria-label="Gallery"></section>
  </main>

  <footer class="site-footer">
    <div class="footer-line footer-main">
      © 2026 Latent Illumination |
      <a
        class="footer-email"
        href="mailto:contact@latentillumination.com"
        title="Email Latent Illumination"
      >
        contact@latentillumination.com
      </a>
    </div>

    <div class="footer-line footer-powered">
      Powered by
      <a
        class="footer-github"
        href="https://github.com/"
        target="_blank"
        rel="noopener noreferrer"
      >
        GitHub
      </a>
    </div>
  </footer>

  <!-- Lightbox (UPDATED only) -->
  <div class="lb" id="lb" aria-hidden="true" role="dialog" aria-label="Image viewer">
    <button class="lb-close" id="lbClose" aria-label="Close">×</button>

    <button class="lb-nav lb-prev" id="lbPrev" aria-label="Previous">‹</button>

    <div class="lb-content" role="document">
      <div class="lb-media">
        <img id="lbImg" class="lb-img" alt="" />
      </div>

      <aside class="lb-side" aria-label="Prompt">
        <pre class="lb-prompt" id="lbPrompt"></pre>
      </aside>
    </div>

    <button class="lb-nav lb-next" id="lbNext" aria-label="Next">›</button>
  </div>

  <script>
    const masonry = document.getElementById("masonry");

    const lb = document.getElementById("lb");
    const lbImg = document.getElementById("lbImg");
    const lbPrompt = document.getElementById("lbPrompt");
    const lbClose = document.getElementById("lbClose");
    const lbPrev = document.getElementById("lbPrev");
    const lbNext = document.getElementById("lbNext");

    let items = [];
    let currentIndex = -1;

    function formatPrompt(raw){
      const text = (raw || "").toString();

      // Remove any MODEL line(s)
      const noModel = text
        .split(/\r?\n/)
        .filter(line => !/^\s*MODEL\s*:/i.test(line.trim()))
        .join("\n")
        .trim();

      // If the remaining text already starts with PROMPT:, keep it.
      if (/^\s*PROMPT\s*:/i.test(noModel)) return noModel.trim();

      // Otherwise, wrap it as PROMPT:
      if (!noModel) return "";
      return `PROMPT:\n${noModel}`;
    }

    function openLB(index){
      currentIndex = index;
      const item = items[currentIndex];

      lbImg.src = item.src;
      lbImg.alt = item.title || "";

      // Prefer item.prompt, fallback to item.caption; always formatted as PROMPT only.
      const raw = item.prompt ?? item.caption ?? "";
      lbPrompt.textContent = formatPrompt(raw);

      lb.classList.add("open");
      lb.setAttribute("aria-hidden", "false");
      updateNavState();
    }

    function closeLB(){
      lb.classList.remove("open");
      lb.setAttribute("aria-hidden", "true");
      lbImg.src = "";
      lbPrompt.textContent = "";
      currentIndex = -1;
    }

    function updateNavState(){
      const hasPrev = currentIndex > 0;
      const hasNext = currentIndex < items.length - 1;
      lbPrev.disabled = !hasPrev;
      lbNext.disabled = !hasNext;
      lbPrev.style.opacity = hasPrev ? "1" : "0.25";
      lbNext.style.opacity = hasNext ? "1" : "0.25";
    }

    function prev(){
      if(currentIndex > 0) openLB(currentIndex - 1);
    }
    function next(){
      if(currentIndex < items.length - 1) openLB(currentIndex + 1);
    }

    async function load(){
      const res = await fetch("gallery.json?v=" + Date.now(), { cache: "no-store" });
      items = await res.json();

      masonry.innerHTML = "";

      items.forEach((item, i) => {
        const card = document.createElement("article");
        card.className = "card";

        const img = document.createElement("img");
        img.loading = "lazy";
        img.src = item.thumb || item.src;
        img.alt = item.title || "";
        img.className = "card-img";
        img.addEventListener("click", () => openLB(i));

        card.appendChild(img);
        masonry.appendChild(card);
      });
    }

    lbClose.addEventListener("click", closeLB);
    lbPrev.addEventListener("click", prev);
    lbNext.addEventListener("click", next);

    lb.addEventListener("click", (e) => {
      if(e.target === lb) closeLB();
    });

    document.addEventListener("keydown", (e) => {
      if(!lb.classList.contains("open")) return;
      if(e.key === "Escape") closeLB();
      if(e.key === "ArrowLeft") prev();
      if(e.key === "ArrowRight") next();
    });

    load();

    // HERO PARALLAX — stronger + overscan-safe
    (function(){
      const hero = document.getElementById("hero");
      const media = document.getElementById("heroMedia");
      if(!hero || !media) return;

      const reduceMotion = window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;
      if(reduceMotion) return;

      let ticking = false;

      function update(){
        const rect = hero.getBoundingClientRect();

        // Only compute while hero is visible
        if (rect.bottom <= 0 || rect.top >= window.innerHeight) return;

        // Progress from 0 → 1 while scrolling through the hero
        const progress = Math.min(Math.max(-rect.top / rect.height, 0), 1);

        // Stronger parallax:
        // - more travel (translate)
        // - more zoom-out
        const translate = progress * 170;      // px (stronger)
        const scale = 1.14 - progress * 0.10;  // start zoomed, ease out

        media.style.transform = `translate3d(0, ${translate}px, 0) scale(${scale})`;
      }

      function onScroll(){
        if(!ticking){
          requestAnimationFrame(() => {
            update();
            ticking = false;
          });
          ticking = true;
        }
      }

      window.addEventListener("scroll", onScroll, { passive: true });
      window.addEventListener("resize", onScroll);
      update();
    })();
  </script>
</body>
</html>
