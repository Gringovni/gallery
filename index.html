<!-- index.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Latent Illumination</title>

  <!-- Google Fonts preconnect (shared) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <!-- Playfair Display (Hero slogan font) -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&display=swap" rel="stylesheet">

  <!-- Inter (Banner + PROMPT label) -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:ital,wght@0,300;0,400;1,300&display=swap" rel="stylesheet">

  <!-- Source Serif 4 (Prompt content) -->
  <link href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,wght@1,300&display=swap" rel="stylesheet">

  <!-- Material Symbols (copy icon) -->
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined&display=swap" rel="stylesheet">

  <!-- Your site styles -->
  <link rel="stylesheet" href="style.css">
  <!-- Favicon: add <link rel="icon" href="assets/your-icon.png"> when you have an assets folder -->

  <meta name="description" content="Latent Illumination — where creative intent becomes visual clarity. A gallery of AI-generated imagery with prompts." />
</head>

<body>
  <a href="#masonry" class="skip-link">Skip to gallery</a>

  <!-- HERO -->
<section class="hero" id="hero" aria-label="Hero" data-scroll-target="#masonry">
  <div class="hero-media" id="heroMedia" style="background-image:url('https://images.pexels.com/photos/20398189/pexels-photo-20398189.jpeg?auto=compress&cs=tinysrgb&w=2400');"></div>

    <!-- Hero editorial text -->
<div class="hero-caption">
  <span class="hero-caption-line">Where creative</span>
  <span class="hero-caption-line">intent becomes</span>
  <span class="hero-caption-line">visual clarity</span>
</div>

  <!-- Scroll cue arrow -->
  <button class="hero-scroll" type="button" aria-label="Scroll to gallery" id="heroScrollBtn"></button>
</section>

  <!-- WHITE BANNER — lives directly below the hero image (NOW the only header; becomes sticky when it reaches top) -->
  <section class="hero-banner" aria-label="Banner">
    <div class="hero-banner-inner">
      <div class="hero-banner-title">LATENT ILLUMINATION</div>
    </div>
    <div class="hero-banner-divider"></div>
  </section>

  <main class="wrap">
    <section id="masonry" class="masonry" aria-label="Gallery" aria-busy="false" aria-live="polite">
      <p class="masonry-loading" id="masonryLoading">Loading gallery…</p>
      <p class="masonry-error hidden" id="masonryError" role="alert"></p>
    </section>
  </main>

  <footer class="site-footer">
    <!-- Footer divider line (restored; must be first visually) -->
    <div class="footer-divider"></div>

    <!-- Footer scroll-to-top arrow (NEW) -->
    <button class="footer-scroll" id="footerScroll" type="button" aria-label="Scroll to gallery"></button>

    <div class="footer-line footer-main">© 2026 Latent Illumination | <a class="footer-email" href="mailto:contact@latentillumination.com" title="Email Latent Illumination">contact@latentillumination.com</a></div>
    <div class="footer-line footer-powered">Powered by <a class="footer-github" href="https://github.com/" target="_blank" rel="noopener noreferrer">GitHub</a></div>
  </footer>

  <!-- Lightbox (UPDATED only) -->
  <div class="lb" id="lb" aria-hidden="true" role="dialog" aria-label="Image viewer">
    <button class="lb-close" id="lbClose" aria-label="Close">×</button>

    <button class="lb-nav lb-prev" id="lbPrev" aria-label="Previous">‹</button>

    <div class="lb-content" role="document">
      <div class="lb-media">
        <a id="lbImgLink" class="lb-media-link" target="_blank" rel="noopener noreferrer" href="#" aria-label="Open image in new tab">
          <img id="lbImg" class="lb-img" alt="" />
        </a>
      </div>

      <aside class="lb-side" aria-label="Prompt">
        <div class="lb-prompt-wrap" id="lbPromptWrap">
          <pre class="lb-prompt" id="lbPrompt"></pre>
        </div>
        <div class="lb-actions">
          <button type="button" class="lb-prompt-more" id="lbPromptMore" aria-label="Show more prompt" aria-expanded="false"><svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" fill="currentColor" aria-hidden="true"><path d="M240-400q-33 0-56.5-23.5T160-480q0-33 23.5-56.5T240-560q33 0 56.5 23.5T320-480q0 33-23.5 56.5T240-400Zm240 0q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm240 0q-33 0-56.5-23.5T640-480q0-33 23.5-56.5T720-560q33 0 56.5 23.5T800-480q0 33-23.5 56.5T720-400Z"/></svg></button>
          <button type="button" class="lb-copy" id="lbCopy" aria-label="Copy prompt to clipboard"><span class="material-symbols-outlined lb-copy-icon" aria-hidden="true">content_copy</span></button>
          <button type="button" class="lb-open-new" id="lbOpenNew" aria-label="Open image in new tab"><svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" fill="currentColor" aria-hidden="true"><path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h280v80H200v560h560v-280h80v280q0 33-23.5 56.5T760-120H200Zm188-212-56-56 372-372H560v-80h280v280h-80v-144L388-332Z"/></svg></button>
        </div>
      </aside>
    </div>

    <button class="lb-nav lb-next" id="lbNext" aria-label="Next">›</button>
  </div>

  <script>
    const masonry = document.getElementById("masonry");

    const lb = document.getElementById("lb");
    const lbImg = document.getElementById("lbImg");
    const lbPrompt = document.getElementById("lbPrompt");
    const lbClose = document.getElementById("lbClose");
    const lbPrev = document.getElementById("lbPrev");
    const lbNext = document.getElementById("lbNext");
    const lbCopy = document.getElementById("lbCopy");
    const lbOpenNew = document.getElementById("lbOpenNew");
    const lbPromptWrap = document.getElementById("lbPromptWrap");
    const lbPromptMore = document.getElementById("lbPromptMore");
    const masonryLoading = document.getElementById("masonryLoading");
    const masonryError = document.getElementById("masonryError");

    let items = [];
    let currentIndex = -1;
    let lastFocusBeforeLB = null;

    function formatPrompt(raw){
      const text = (raw || "").toString();

      // Remove any MODEL line(s)
      const noModel = text
        .split(/\r?\n/)
        .filter(line => !/^\s*MODEL\s*:/i.test(line.trim()))
        .join("\n")
        .trim();

      // If the remaining text already starts with PROMPT:, keep it.
      if (/^\s*PROMPT\s*:/i.test(noModel)) return noModel.trim();

      // Otherwise, wrap it as PROMPT:
      if (!noModel) return "";
      return `PROMPT:\n${noModel}`;
    }

    function openLB(index){
      currentIndex = index;
      const item = items[currentIndex];
      lastFocusBeforeLB = document.activeElement;

      lbImg.src = item.src;
      lbImg.alt = item.title || "";
      const lbImgLink = document.getElementById("lbImgLink");
      if (lbImgLink) { lbImgLink.href = item.src; }

      const raw = item.prompt ?? item.caption ?? "";
      lbPrompt.textContent = formatPrompt(raw);

      lb.classList.add("open");
      lb.setAttribute("aria-hidden", "false");
      updateNavState();
      lbClose.focus();
      // Reset mobile prompt collapse when opening a new image
      if (lbPromptWrap) lbPromptWrap.classList.remove("lb-prompt-expanded");
      if (lbPromptMore) lbPromptMore.setAttribute("aria-expanded", "false");
    }

    function closeLB(){
      lb.classList.remove("open");
      lb.setAttribute("aria-hidden", "true");
      lbImg.src = "";
      lbPrompt.textContent = "";
      const lbImgLink = document.getElementById("lbImgLink");
      if (lbImgLink) { lbImgLink.removeAttribute("href"); }
      currentIndex = -1;
      if (lastFocusBeforeLB && lastFocusBeforeLB.focus) lastFocusBeforeLB.focus();
    }

    function updateNavState(){
      const hasPrev = currentIndex > 0;
      const hasNext = currentIndex < items.length - 1;
      lbPrev.disabled = !hasPrev;
      lbNext.disabled = !hasNext;
      lbPrev.style.opacity = hasPrev ? "1" : "0.25";
      lbNext.style.opacity = hasNext ? "1" : "0.25";
    }

    function prev(){
      if(currentIndex > 0) openLB(currentIndex - 1);
    }
    function next(){
      if(currentIndex < items.length - 1) openLB(currentIndex + 1);
    }

    async function load(){
      masonry.setAttribute("aria-busy", "true");
      masonryLoading.classList.remove("hidden");
      masonryError.classList.add("hidden");
      masonryError.textContent = "";

      try {
        const res = await fetch("gallery.json?v=" + Date.now(), { cache: "no-store" });
        if (!res.ok) throw new Error("Failed to load gallery");
        items = await res.json();
      } catch (err) {
        masonryError.textContent = "Could not load gallery. Please try again later.";
        masonryError.classList.remove("hidden");
        masonryLoading.classList.add("hidden");
        masonry.setAttribute("aria-busy", "false");
        return;
      }

      masonryLoading.classList.add("hidden");
      masonryError.classList.add("hidden");
      masonry.setAttribute("aria-busy", "false");

      const existingCards = masonry.querySelectorAll(".card");
      existingCards.forEach((el) => el.remove());

      items.forEach((item, i) => {
        const card = document.createElement("article");
        card.className = "card";

        const img = document.createElement("img");
        img.loading = "lazy";
        img.src = item.thumb || item.src;
        img.alt = item.title || "";
        img.className = "card-img";
        img.addEventListener("click", () => openLB(i));

        card.appendChild(img);
        masonry.appendChild(card);
      });
    }

    lbClose.addEventListener("click", closeLB);
    lbPrev.addEventListener("click", prev);
    lbNext.addEventListener("click", next);

    if (lbOpenNew) {
      lbOpenNew.addEventListener("click", () => {
        if (currentIndex >= 0 && items[currentIndex]) {
          window.open(items[currentIndex].src, "_blank", "noopener,noreferrer");
        }
      });
    }

    if (lbPromptMore && lbPromptWrap) {
      lbPromptMore.addEventListener("click", () => {
        const expanded = lbPromptWrap.classList.toggle("lb-prompt-expanded");
        lbPromptMore.setAttribute("aria-expanded", expanded);
        lbPromptMore.setAttribute("aria-label", expanded ? "Show less prompt" : "Show more prompt");
      });
    }

    if (lbCopy) {
      lbCopy.addEventListener("click", () => {
        let text = (lbPrompt.textContent || "").trim();
        if (!text) return;
        // Copy only the prompt description, not the "PROMPT:" label
        text = text.replace(/^\s*PROMPT\s*:\s*\n?/i, "").trim();
        navigator.clipboard.writeText(text).then(() => {
          const icon = lbCopy.querySelector(".lb-copy-icon");
          if (icon) {
            const orig = icon.textContent;
            icon.textContent = "done";
            setTimeout(() => { icon.textContent = orig; }, 1500);
          }
        });
      });
    }

    lb.addEventListener("click", (e) => {
      if(e.target === lb) closeLB();
    });

    lb.addEventListener("keydown", (e) => {
      if (!lb.classList.contains("open")) return;
      if (e.key === "Tab") {
        const focusables = Array.from(lb.querySelectorAll("button:not([disabled])"));
        const first = focusables[0], last = focusables[focusables.length - 1];
        if (e.shiftKey && document.activeElement === first) { e.preventDefault(); last.focus(); }
        else if (!e.shiftKey && document.activeElement === last) { e.preventDefault(); first.focus(); }
      }
    });

    document.addEventListener("keydown", (e) => {
      if(!lb.classList.contains("open")) return;
      if(e.key === "Escape") closeLB();
      if(e.key === "ArrowLeft") prev();
      if(e.key === "ArrowRight") next();
    });

    // Mobile: swipe on image area to go prev/next (arrows hidden on mobile)
    (function(){
      const lbMedia = document.querySelector(".lb-media");
      if (!lbMedia) return;
      let touchStartX = 0;
      const minSwipe = 50;

      lbMedia.addEventListener("touchstart", (e) => {
        if (e.touches.length) touchStartX = e.touches[0].clientX;
      }, { passive: true });

      lbMedia.addEventListener("touchend", (e) => {
        if (!lb.classList.contains("open") || !e.changedTouches.length) return;
        const touchEndX = e.changedTouches[0].clientX;
        const delta = touchEndX - touchStartX;
        if (delta > minSwipe) prev();
        else if (delta < -minSwipe) next();
      }, { passive: true });
    })();

    load();

    // HERO PARALLAX — stronger + overscan-safe
    (function(){
      const hero = document.getElementById("hero");
      const media = document.getElementById("heroMedia");
      if(!hero || !media) return;

      const reduceMotion = window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;
      if(reduceMotion) return;

      let ticking = false;

      function update(){
        const rect = hero.getBoundingClientRect();

        // Only compute while hero is visible
        if (rect.bottom <= 0 || rect.top >= window.innerHeight) return;

        // Progress from 0 → 1 while scrolling through the hero
        const progress = Math.min(Math.max(-rect.top / rect.height, 0), 1);

        // Stronger parallax:
        // - more travel (translate)
        // - more zoom-out
        const isDesktop = window.innerWidth >= 900;

// Mobile = current feel (unchanged)
const maxTranslate = isDesktop ? 260 : 170;
const maxScaleOut  = isDesktop ? 0.14 : 0.10;

const translate = progress * maxTranslate;
const scale = 1.14 - progress * maxScaleOut;

        media.style.transform = `translate3d(0, ${translate}px, 0) scale(${scale})`;
      }

      function onScroll(){
        if(!ticking){
          requestAnimationFrame(() => {
            update();
            ticking = false;
          });
          ticking = true;
        }
      }

      window.addEventListener("scroll", onScroll, { passive: true });
      window.addEventListener("resize", onScroll);
      update();
    })();

    // Smooth scroll to gallery (used by hero click and hero scroll button)
    function smoothScrollToGallery(){
      const target = document.getElementById("masonry");
      const banner = document.querySelector(".hero-banner");
      if(!target) return;
      const startY = window.scrollY;
      const offset = banner ? banner.offsetHeight : 0;
      const targetY = target.getBoundingClientRect().top + window.scrollY - offset;
      const distance = targetY - startY;
      const duration = 1400;
      const startTime = performance.now();
      function easeInOutCubic(t){ return t < 0.5 ? 4*t*t*t : 1 - Math.pow(-2*t + 2, 3) / 2; }
      function step(now){
        const elapsed = now - startTime;
        const t = Math.min(elapsed / duration, 1);
        window.scrollTo(0, startY + distance * easeInOutCubic(t));
        if(t < 1) requestAnimationFrame(step);
      }
      requestAnimationFrame(step);
    }

    (function(){
      const hero = document.getElementById("hero");
      const heroScrollBtn = document.getElementById("heroScrollBtn");
      const target = document.getElementById("masonry");
      if(!hero || !target) return;
      hero.style.cursor = "pointer";
      hero.addEventListener("click", (e) => { if (e.target === hero || e.target.closest(".hero-media") || e.target.closest(".hero-caption")) smoothScrollToGallery(); });
      if (heroScrollBtn) heroScrollBtn.addEventListener("click", (e) => { e.stopPropagation(); smoothScrollToGallery(); });
    })();

    // FOOTER ARROW CLICK → SCROLL TO TOP (mirrored behavior)
(function(){
  const btn = document.getElementById("footerScroll");
  const target = document.getElementById("masonry");
  const banner = document.querySelector(".hero-banner");
  if(!btn || !target) return;

  btn.addEventListener("click", () => {
    const startY = window.scrollY;
    const offset = banner ? banner.offsetHeight : 0;
    const targetY =
      target.getBoundingClientRect().top + window.scrollY - offset;
    const distance = targetY - startY;

        const duration = 1400; // ms (matches hero)
        const startTime = performance.now();

        function easeInOutCubic(t){
          return t < 0.5 ? 4*t*t*t : 1 - Math.pow(-2*t + 2, 3) / 2;
        }

        function step(now){
          const elapsed = now - startTime;
          const t = Math.min(elapsed / duration, 1);
          const eased = easeInOutCubic(t);

          window.scrollTo(0, startY + distance * eased);

          if(t < 1) requestAnimationFrame(step);
        }

        requestAnimationFrame(step);
      });
    })();
  </script>
</body>
</html>
