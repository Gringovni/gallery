<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Latent Illumination — Gallery</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" type="image/png" href="fast-forward.png">
</head>
<body>
  <header>
    <div class="nav">
      <div class="brand">Latent Illumination</div>
      <nav class="links">
        <a href="#">Work</a>
        <a href="mailto:hello@latentillumination.com">Contact</a>
      </nav>
    </div>
  </header>

  <main>
    <section class="grid" id="grid"></section>
  </main>

  <footer>
    <div>© <span id="year"></span> Latent Illumination</div>
    <div class="social">
      <a href="#" aria-label="Instagram">IG</a>
      <a href="#" aria-label="X">X</a>
      <a href="#" aria-label="YouTube">YT</a>
    </div>
  </footer>

  <!-- Lightbox -->
  <div class="lightbox" id="lightbox" aria-hidden="true">
  <button class="lb-arrow lb-prev" id="prevBtn" aria-label="Previous">‹</button>

  <div class="lightbox-inner">
    <img class="lightbox-img" id="lbImg" alt="Full view" />
    <div class="lightbox-bar">
      <div class="lightbox-prompt" id="lbPrompt"></div>
      <div class="actions">
        <button class="btn" id="copyBtn">Copy prompt</button>
        <button class="btn" id="closeBtn">Close</button>
      </div>
    </div>
  </div>

  <button class="lb-arrow lb-next" id="nextBtn" aria-label="Next">›</button>
</div>

<script>
  document.getElementById("year").textContent = new Date().getFullYear();

  const grid = document.getElementById("grid");
  const lightbox = document.getElementById("lightbox");
  const lbImg = document.getElementById("lbImg");
  const lbPrompt = document.getElementById("lbPrompt");
  const closeBtn = document.getElementById("closeBtn");
  const copyBtn = document.getElementById("copyBtn");

  const prevBtn = document.getElementById("prevBtn");
  const nextBtn = document.getElementById("nextBtn");

  let items = [];
  let currentIndex = 0;

  function openLB(index){
    currentIndex = index;
    const item = items[currentIndex];
    lbImg.src = item.src;
    lbPrompt.textContent = item.prompt || "";
    lightbox.classList.add("open");
    lightbox.setAttribute("aria-hidden", "false");
  }

  function closeLB(){
    lightbox.classList.remove("open");
    lightbox.setAttribute("aria-hidden", "true");
    lbImg.src = "";
    lbPrompt.textContent = "";
  }

  function showPrev(){
    if(!items.length) return;
    currentIndex = (currentIndex - 1 + items.length) % items.length;
    openLB(currentIndex);
  }

  function showNext(){
    if(!items.length) return;
    currentIndex = (currentIndex + 1) % items.length;
    openLB(currentIndex);
  }

  async function loadGallery(){
    const res = await fetch("gallery.json?v=" + Date.now(), { cache: "no-store" });
    items = await res.json();

    grid.innerHTML = "";
    items.forEach((item, index) => {
      const fig = document.createElement("figure");
      fig.className = "tile";

      const img = document.createElement("img");
      img.src = item.src;
      img.alt = item.title || "Artwork";
      img.addEventListener("click", () => openLB(index));

      const cap = document.createElement("div");
      cap.className = "caption";
      cap.textContent = item.prompt || "";

      fig.appendChild(img);
      fig.appendChild(cap);
      grid.appendChild(fig);
    });
  }

  // Close
  closeBtn.addEventListener("click", closeLB);
  lightbox.addEventListener("click", (e) => { if(e.target === lightbox) closeLB(); });

  // Prev/Next arrows
  prevBtn.addEventListener("click", (e) => { e.stopPropagation(); showPrev(); });
  nextBtn.addEventListener("click", (e) => { e.stopPropagation(); showNext(); });

  // Keyboard
  document.addEventListener("keydown", (e) => {
    if(!lightbox.classList.contains("open")) return;

    if(e.key === "Escape") closeLB();
    if(e.key === "ArrowLeft") showPrev();
    if(e.key === "ArrowRight") showNext();
  });

  // Copy prompt
  copyBtn.addEventListener("click", async () => {
    try{
      await navigator.clipboard.writeText(lbPrompt.textContent.trim());
      copyBtn.textContent = "Copied!";
      setTimeout(() => copyBtn.textContent = "Copy prompt", 1200);
    }catch{
      copyBtn.textContent = "Copy failed";
      setTimeout(() => copyBtn.textContent = "Copy prompt", 1200);
    }
  });

  loadGallery();
</script>
